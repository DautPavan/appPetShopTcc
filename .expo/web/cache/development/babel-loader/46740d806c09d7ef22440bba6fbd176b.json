{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\Daut\\\\Desktop\\\\unip\\\\TCC\\\\mobile\\\\appPetShop\\\\src\\\\pages\\\\Login\\\\index.tsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from 'react';\nimport Image from \"react-native-web/dist/exports/Image\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport { RectButton } from 'react-native-gesture-handler';\nimport { Feather as Icon } from '@expo/vector-icons';\nimport styles from \"./styles\";\nimport image from \"../../assets/logo.png\";\nimport background from \"../../assets/home-background.png\";\nimport { useNavigation } from '@react-navigation/native';\nimport api from \"../../services/api\";\nimport * as SecureStore from 'expo-secure-store';\n\nfunction Login() {\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      value = _useState2[0],\n      onChangeValue = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      login = _useState4[0],\n      setLogin = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      senha = _useState6[0],\n      setSenha = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      token = _useState8[0],\n      setToken = _useState8[1];\n\n  var _useState9 = useState(''),\n      _useState10 = _slicedToArray(_useState9, 2),\n      error = _useState10[0],\n      setError = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      modalVisible = _useState12[0],\n      setModalVisible = _useState12[1];\n\n  var navigation = useNavigation();\n\n  var saveToken = function saveToken(value) {\n    return _regeneratorRuntime.async(function saveToken$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(SecureStore.deleteItemAsync('token'));\n\n          case 2:\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(SecureStore.setItemAsync('token', value));\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var saveNome = function saveNome(value) {\n    return _regeneratorRuntime.async(function saveNome$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(SecureStore.deleteItemAsync('Nome'));\n\n          case 2:\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(SecureStore.setItemAsync('Nome', value));\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleNavigateBack = function handleNavigateBack() {\n    var jsonBody;\n    return _regeneratorRuntime.async(function handleNavigateBack$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setModalVisible(true);\n            setError(\"\");\n\n            if (!(login.length == 0)) {\n              _context3.next = 5;\n              break;\n            }\n\n            setError(\"Informa um email\");\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            if (!(senha.length == 0)) {\n              _context3.next = 8;\n              break;\n            }\n\n            setError(\"Informa uma senha\");\n            return _context3.abrupt(\"return\");\n\n          case 8:\n            jsonBody = {\n              Login: login,\n              Senha: senha\n            };\n            api.post('Login/Login', jsonBody).then(function (response) {\n              setModalVisible(false);\n              setError(\"\");\n              console.log(response.data.token);\n              saveToken(response.data.token).then(function () {\n                saveNome(response.data.nome).then(function () {\n                  navigation.navigate(\"Menu\");\n                });\n              }).catch(function () {\n                throw \"Ocorreu um erro ao salvar o token\";\n              });\n            }).catch(function (error) {\n              setModalVisible(false);\n\n              if (error.response.status >= 400 && error.response.status < 500) {\n                setError(\"Usuario não localizado\");\n              } else {\n                setError(\"Houve um erro na requisição: \" + error.response.status);\n              }\n            });\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var registrarUsuario = function registrarUsuario() {\n    navigation.navigate(\"RegistrarUsuario\");\n  };\n\n  useEffect(function () {\n    var unsubscribe = navigation.addListener('focus', function () {\n      setModalVisible(true);\n      SecureStore.deleteItemAsync('token');\n      setModalVisible(false);\n    });\n    return unsubscribe;\n  }, [navigation]);\n  return React.createElement(React.Fragment, null, React.createElement(ImageBackground, {\n    source: background,\n    style: styles.container,\n    resizeMode: \"contain\",\n    imageStyle: {\n      width: 274,\n      height: 368\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: styles.main,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  }, React.createElement(Image, {\n    source: image,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 17\n    }\n  }), React.createElement(Text, {\n    style: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 17\n    }\n  }, \"PetShop\"), React.createElement(Text, {\n    style: styles.description,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 17\n    }\n  }, \"Bem-vindo ao app de agendamento do nosso petshop.\")), React.createElement(View, {\n    style: styles.footer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }\n  }, React.createElement(TextInput, {\n    style: styles.input,\n    placeholder: \"Digite seu login\",\n    value: login,\n    autoCorrect: false,\n    onChangeText: setLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 17\n    }\n  }), React.createElement(TextInput, {\n    style: styles.input,\n    secureTextEntry: true,\n    placeholder: \"Digite seu senha\",\n    value: senha,\n    autoCorrect: false,\n    onChangeText: setSenha,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 17\n    }\n  }), React.createElement(Text, {\n    style: styles.titleAlert,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 17\n    }\n  }, error), React.createElement(RectButton, {\n    style: styles.button,\n    onPress: handleNavigateBack,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 17\n    }\n  }, React.createElement(View, {\n    style: styles.buttonIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 21\n    }\n  }, React.createElement(Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 25\n    }\n  }, React.createElement(Icon, {\n    name: \"arrow-right\",\n    color: \"#FFF\",\n    size: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 29\n    }\n  }))), React.createElement(Text, {\n    style: styles.buttonText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 21\n    }\n  }, \"Entrar\")), React.createElement(Text, {\n    style: styles.titleRegister,\n    onPress: registrarUsuario,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  }, \"Registrar - se\"))), React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }, React.createElement(Modal, {\n    animationType: \"slide\",\n    transparent: true,\n    visible: modalVisible,\n    onRequestClose: function onRequestClose() {\n      setModalVisible(!modalVisible);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 13\n    }\n  }, React.createElement(View, {\n    style: styles.centeredView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 17\n    }\n  }, React.createElement(View, {\n    style: styles.modalView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 21\n    }\n  }, React.createElement(Text, {\n    style: styles.modalText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 25\n    }\n  }, \"Carregando\"), React.createElement(Image, {\n    source: require(\"./../../assets/loading.gif\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }))))));\n}\n\nexport default Login;","map":{"version":3,"sources":["C:/Users/Daut/Desktop/unip/TCC/mobile/appPetShop/src/pages/Login/index.tsx"],"names":["React","useEffect","useState","RectButton","Feather","Icon","styles","image","background","useNavigation","api","SecureStore","Login","value","onChangeValue","login","setLogin","senha","setSenha","token","setToken","error","setError","modalVisible","setModalVisible","navigation","saveToken","deleteItemAsync","setItemAsync","saveNome","handleNavigateBack","length","jsonBody","Senha","post","then","response","console","log","data","nome","navigate","catch","status","registrarUsuario","unsubscribe","addListener","container","width","height","main","title","description","footer","input","titleAlert","button","buttonIcon","buttonText","titleRegister","centeredView","modalView","modalText","require"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Image, ImageBackground, Text, View, TextInput, Modal, Pressable } from 'react-native';\r\nimport { RectButton } from 'react-native-gesture-handler'\r\nimport { Feather as Icon } from '@expo/vector-icons'\r\nimport styles from './styles';\r\nimport image from '../../assets/logo.png';\r\nimport background from '../../assets/home-background.png';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport { StackNavigationProp } from '@react-navigation/stack';\r\nimport { RootStackParamList } from '../rootStackNavigator';\r\nimport api from '../../services/api';\r\nimport * as SecureStore from 'expo-secure-store';\r\n\r\nfunction Login() {\r\n    const [value, onChangeValue] = useState('');\r\n    const [login, setLogin] = useState('');\r\n    const [senha, setSenha] = useState('');\r\n    const [token, setToken] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [modalVisible, setModalVisible] = useState(false);\r\n\r\n    type homeScreenProp = StackNavigationProp<RootStackParamList, 'Login'>;\r\n    const navigation = useNavigation<homeScreenProp>();\r\n\r\n    const saveToken = async (value: string) => {\r\n        await SecureStore.deleteItemAsync('token');\r\n        await SecureStore.setItemAsync('token', value);\r\n    }\r\n\r\n    const saveNome = async (value: string) => {\r\n        await SecureStore.deleteItemAsync('Nome');\r\n        await SecureStore.setItemAsync('Nome', value);\r\n    }\r\n\r\n    const handleNavigateBack = async () => {\r\n        setModalVisible(true);\r\n        setError(\"\");\r\n\r\n        if (login.length == 0 )\r\n        {\r\n            setError(\"Informa um email\")\r\n            return;\r\n        }\r\n\r\n        if (senha.length == 0 )\r\n        {\r\n            setError(\"Informa uma senha\")\r\n            return;\r\n        }\r\n        \r\n        const jsonBody = { Login: login, Senha: senha };\r\n        \r\n        api.post('Login/Login', jsonBody)\r\n            .then(response => {\r\n                setModalVisible(false);\r\n                setError(\"\");\r\n                console.log(response.data.token)\r\n                saveToken(response.data.token).then(() => {\r\n                    saveNome(response.data.nome).then(() => {\r\n                        navigation.navigate(\"Menu\");\r\n                    });                    \r\n                })\r\n                .catch(() => {\r\n                    throw \"Ocorreu um erro ao salvar o token\";\r\n                })\r\n            })\r\n            .catch(error => {\r\n                setModalVisible(false);\r\n                if (error.response.status >= 400 && error.response.status < 500) {\r\n                    setError(\"Usuario não localizado\")\r\n                }else {\r\n                    setError(\"Houve um erro na requisição: \" + error.response.status)\r\n                }\r\n            });\r\n    }\r\n\r\n    const registrarUsuario = () => {\r\n        navigation.navigate(\"RegistrarUsuario\");\r\n\r\n    }\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = navigation.addListener('focus', () => {\r\n            setModalVisible(true);\r\n            SecureStore.deleteItemAsync('token');\r\n            setModalVisible(false);\r\n        });\r\n        return unsubscribe;\r\n    }, [navigation]);\r\n\r\n    return (\r\n        <>\r\n        <ImageBackground \r\n            source={background} \r\n            style={styles.container}\r\n            resizeMode=\"contain\"\r\n            imageStyle={{width: 274, height: 368 }}>\r\n\r\n            <View style={styles.main}>\r\n                <Image source={image}/>\r\n                <Text style={styles.title}>PetShop</Text>\r\n                <Text style={styles.description}>Bem-vindo ao app de agendamento do nosso petshop.</Text>\r\n            </View>\r\n\r\n            <View style={styles.footer}>\r\n                <TextInput \r\n                    style={styles.input}\r\n                    placeholder=\"Digite seu login\"\r\n                    value={login}\r\n                    autoCorrect={false}\r\n                    onChangeText={setLogin}\r\n                >\r\n\r\n                </TextInput>\r\n                <TextInput \r\n                    style={styles.input}\r\n                    secureTextEntry={true}\r\n                    placeholder=\"Digite seu senha\"\r\n                    value={senha}\r\n                    autoCorrect={false}\r\n                    onChangeText={setSenha}\r\n                >\r\n\r\n                </TextInput>\r\n\r\n                <Text style={styles.titleAlert}>{error}</Text>\r\n\r\n                <RectButton style={styles.button} onPress={handleNavigateBack}>\r\n                    <View style={styles.buttonIcon}>                        \r\n                        <Text>\r\n                            <Icon \r\n                                name=\"arrow-right\" \r\n                                color=\"#FFF\" \r\n                                size={24}\r\n                            />\r\n                        </Text>\r\n                    </View>\r\n                    <Text style={styles.buttonText}>Entrar</Text>\r\n                </RectButton>\r\n\r\n                <Text\r\n                    style={styles.titleRegister}\r\n                    onPress={registrarUsuario}>\r\n                    Registrar - se\r\n                </Text>\r\n\r\n            </View>\r\n        </ImageBackground>\r\n\r\n        <View>\r\n            <Modal\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                visible={modalVisible}\r\n                onRequestClose={() => {\r\n                setModalVisible(!modalVisible);\r\n                }}\r\n            >\r\n                <View style={styles.centeredView}>\r\n                    <View style={styles.modalView}>\r\n                        <Text style={styles.modalText}>Carregando</Text>\r\n                        <Image source={require('./../../assets/loading.gif')}/>\r\n                        \r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n\r\n        </>\r\n    );\r\n\r\n}\r\n\r\nexport default Login;"]},"metadata":{},"sourceType":"module"}